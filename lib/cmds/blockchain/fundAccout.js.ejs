/*global web3, eth*/

(function () {

var workAccount = '<%- accountAddress %>';

// Blockchain process ends if Javascript ends
function keepAlive() {
    setInterval(function () {
        // Just stay alive
    }, 999999);
}

var workAccountBalance = eth.getBalance(workAccount);
var TARGET = 15000000000000000000;
if (workAccountBalance >= TARGET) {
    return keepAlive();
}

function getNonce() {
    return web3.eth.getTransactionCount(eth.coinbase);
}

function getGasPrice() {
    return web3.eth.getGasPrice();
}

function sendTransaction(nonce, gasPrice) {
    web3.eth.sendTransaction({
            from: eth.coinbase,
            to: workAccount,
            value: TARGET - workAccountBalance,
            gasPrice: gasPrice,
            nonce: nonce
        }, function (err, _result) {
        if (err) {
            console.error('Error while transferring funds to user account', err);
        }
    });
}

try {
    var nonce = getNonce();
    var gasPrice = getGasPrice();
    sendTransaction(nonce, gasPrice);
} catch (e) {
    console.error('Error while getting nonce or gas price', e);
}


keepAlive();

})();
